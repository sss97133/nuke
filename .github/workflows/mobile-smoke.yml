name: Mobile viewport smoke

on:
  push:
    branches: [ main ]
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'

jobs:
  smoke:
    runs-on: ubuntu-latest
    steps:
      - name: Test production pages are not blank on mobile UA
        run: |
          set -euo pipefail
          MOBILE_UA="Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Mobile/15E148 Safari/604.1"
          for URL in "https://nukefrontend.vercel.app" "https://nuke.vercel.app"; do
            echo "Testing $URL"
            # Fetch headers and body
            STATUS=$(curl -s -A "$MOBILE_UA" -o /dev/null -w "%{http_code}" "$URL")
            if [ "$STATUS" -lt 200 ] || [ "$STATUS" -ge 400 ]; then
              echo "Unexpected status: $STATUS for $URL"
              exit 1
            fi
            HTML=$(curl -s -A "$MOBILE_UA" "$URL")
            # Basic non-blank checks
            echo "$HTML" | grep -qi "<title>" || true
            echo "$HTML" | grep -qi "<div id=\"root\">" || true
            LEN=$(printf "%s" "$HTML" | wc -c)
            if [ "$LEN" -lt 500 ]; then
              echo "HTML content too small ($LEN bytes) for $URL"
              exit 1
            fi
            echo "OK: $URL ($LEN bytes)"
          done
