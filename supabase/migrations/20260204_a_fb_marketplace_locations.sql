-- Facebook Marketplace Geographic Coverage
-- Creates comprehensive US metro area coverage for vehicle listing sweeps
-- Target: 500+ locations covering all 50 states with emphasis on population centers

CREATE TABLE IF NOT EXISTS fb_marketplace_locations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,                    -- "Los Angeles, CA"
  state_code TEXT NOT NULL,              -- "CA"
  latitude NUMERIC(9,6) NOT NULL,
  longitude NUMERIC(9,6) NOT NULL,
  radius_miles INTEGER DEFAULT 40,
  population INTEGER,                    -- For prioritization
  is_active BOOLEAN DEFAULT TRUE,
  last_sweep_at TIMESTAMPTZ,
  last_sweep_listings INTEGER DEFAULT 0,
  total_listings_found INTEGER DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX IF NOT EXISTS idx_fb_locations_active ON fb_marketplace_locations(is_active, last_sweep_at);
CREATE INDEX IF NOT EXISTS idx_fb_locations_state ON fb_marketplace_locations(state_code);
CREATE INDEX IF NOT EXISTS idx_fb_locations_population ON fb_marketplace_locations(population DESC NULLS LAST);

-- Add unique constraint to prevent duplicate locations
CREATE UNIQUE INDEX IF NOT EXISTS idx_fb_locations_unique_name ON fb_marketplace_locations(name);

-- ============================================================================
-- SEED DATA: 500+ US Metro Areas
-- Sources: US Census Bureau population estimates, state capitals, major metros
-- ============================================================================

INSERT INTO fb_marketplace_locations (name, state_code, latitude, longitude, population, radius_miles) VALUES

-- ============================================================================
-- ALABAMA (10 locations)
-- ============================================================================
('Birmingham, AL', 'AL', 33.520661, -86.802490, 200733, 40),
('Montgomery, AL', 'AL', 32.366805, -86.299969, 198525, 40),
('Huntsville, AL', 'AL', 34.730369, -86.586104, 215006, 40),
('Mobile, AL', 'AL', 30.695366, -88.039891, 187041, 40),
('Tuscaloosa, AL', 'AL', 33.209684, -87.569132, 100618, 35),
('Hoover, AL', 'AL', 33.405475, -86.811388, 92606, 30),
('Dothan, AL', 'AL', 31.223232, -85.390485, 71072, 35),
('Auburn, AL', 'AL', 32.609857, -85.480782, 76143, 30),
('Decatur, AL', 'AL', 34.605925, -86.983340, 57938, 30),
('Florence, AL', 'AL', 34.799812, -87.677251, 40184, 35),

-- ============================================================================
-- ALASKA (5 locations)
-- ============================================================================
('Anchorage, AK', 'AK', 61.218056, -149.900278, 291247, 50),
('Fairbanks, AK', 'AK', 64.837778, -147.716389, 32325, 40),
('Juneau, AK', 'AK', 58.301944, -134.419722, 32255, 30),
('Wasilla, AK', 'AK', 61.581111, -149.440556, 12500, 35),
('Sitka, AK', 'AK', 57.053056, -135.330000, 8458, 25),

-- ============================================================================
-- ARIZONA (12 locations)
-- ============================================================================
('Phoenix, AZ', 'AZ', 33.448376, -112.074036, 1608139, 50),
('Tucson, AZ', 'AZ', 32.221743, -110.926479, 542629, 45),
('Mesa, AZ', 'AZ', 33.415184, -111.831472, 504258, 35),
('Chandler, AZ', 'AZ', 33.306160, -111.841250, 275987, 30),
('Scottsdale, AZ', 'AZ', 33.494170, -111.926052, 241361, 30),
('Glendale, AZ', 'AZ', 33.538652, -112.185990, 248325, 30),
('Gilbert, AZ', 'AZ', 33.352830, -111.789027, 267918, 30),
('Tempe, AZ', 'AZ', 33.425510, -111.940005, 180587, 25),
('Peoria, AZ', 'AZ', 33.580570, -112.237380, 190985, 30),
('Surprise, AZ', 'AZ', 33.629858, -112.367996, 141664, 30),
('Yuma, AZ', 'AZ', 32.692570, -114.615470, 95548, 40),
('Flagstaff, AZ', 'AZ', 35.198284, -111.651302, 73964, 40),

-- ============================================================================
-- ARKANSAS (8 locations)
-- ============================================================================
('Little Rock, AR', 'AR', 34.746481, -92.289595, 202591, 45),
('Fort Smith, AR', 'AR', 35.385925, -94.398552, 89142, 40),
('Fayetteville, AR', 'AR', 36.062586, -94.157433, 93949, 35),
('Springdale, AR', 'AR', 36.186718, -94.128754, 86014, 30),
('Jonesboro, AR', 'AR', 35.842297, -90.704279, 78576, 35),
('Rogers, AR', 'AR', 36.332023, -94.118550, 72758, 30),
('Conway, AR', 'AR', 35.088649, -92.442101, 67336, 30),
('North Little Rock, AR', 'AR', 34.769536, -92.267052, 66075, 25),

-- ============================================================================
-- CALIFORNIA (50 locations - largest state by population)
-- ============================================================================
('Los Angeles, CA', 'CA', 34.052234, -118.243685, 3898747, 50),
('San Diego, CA', 'CA', 32.715738, -117.161084, 1386932, 45),
('San Jose, CA', 'CA', 37.338208, -121.886329, 1013240, 40),
('San Francisco, CA', 'CA', 37.774929, -122.419416, 873965, 35),
('Fresno, CA', 'CA', 36.737798, -119.787125, 542107, 45),
('Sacramento, CA', 'CA', 38.581572, -121.494400, 524943, 45),
('Long Beach, CA', 'CA', 33.770050, -118.193739, 466742, 30),
('Oakland, CA', 'CA', 37.804364, -122.271114, 433031, 30),
('Bakersfield, CA', 'CA', 35.373292, -119.018713, 403455, 45),
('Anaheim, CA', 'CA', 33.835293, -117.914505, 350365, 30),
('Santa Ana, CA', 'CA', 33.745573, -117.867834, 310227, 25),
('Riverside, CA', 'CA', 33.953350, -117.396156, 314998, 40),
('Stockton, CA', 'CA', 37.957702, -121.290780, 320804, 40),
('Irvine, CA', 'CA', 33.683947, -117.794694, 307670, 30),
('Chula Vista, CA', 'CA', 32.640054, -117.084195, 275487, 30),
('Fremont, CA', 'CA', 37.548270, -121.988572, 230504, 30),
('San Bernardino, CA', 'CA', 34.108345, -117.289765, 222101, 40),
('Modesto, CA', 'CA', 37.639097, -120.996878, 218464, 40),
('Fontana, CA', 'CA', 34.092233, -117.435048, 214547, 30),
('Moreno Valley, CA', 'CA', 33.942465, -117.229673, 212569, 30),
('Santa Clarita, CA', 'CA', 34.391664, -118.542586, 228673, 35),
('Glendale, CA', 'CA', 34.142508, -118.255075, 196543, 25),
('Huntington Beach, CA', 'CA', 33.660297, -117.999225, 198711, 30),
('Garden Grove, CA', 'CA', 33.774204, -117.960709, 172646, 25),
('Oceanside, CA', 'CA', 33.195870, -117.379483, 176193, 35),
('Rancho Cucamonga, CA', 'CA', 34.106362, -117.593137, 177603, 30),
('Ontario, CA', 'CA', 34.063344, -117.650888, 175265, 30),
('Santa Rosa, CA', 'CA', 38.440429, -122.714055, 178127, 35),
('Elk Grove, CA', 'CA', 38.408765, -121.371617, 176124, 30),
('Corona, CA', 'CA', 33.875293, -117.566437, 157136, 30),
('Lancaster, CA', 'CA', 34.686786, -118.154163, 173516, 40),
('Palmdale, CA', 'CA', 34.579434, -118.116461, 169450, 40),
('Salinas, CA', 'CA', 36.677737, -121.655501, 163542, 35),
('Pomona, CA', 'CA', 34.055228, -117.752264, 151348, 25),
('Hayward, CA', 'CA', 37.668821, -122.080796, 162954, 25),
('Escondido, CA', 'CA', 33.119207, -117.086421, 151038, 30),
('Sunnyvale, CA', 'CA', 37.368830, -122.036350, 155805, 25),
('Torrance, CA', 'CA', 33.835849, -118.340628, 145438, 25),
('Pasadena, CA', 'CA', 34.147785, -118.144516, 138699, 25),
('Orange, CA', 'CA', 33.787794, -117.853112, 139911, 25),
('Fullerton, CA', 'CA', 33.870350, -117.924271, 139132, 25),
('Thousand Oaks, CA', 'CA', 34.170561, -118.837594, 126966, 30),
('Roseville, CA', 'CA', 38.752125, -121.288010, 147773, 30),
('Concord, CA', 'CA', 37.977979, -122.031073, 129295, 25),
('Simi Valley, CA', 'CA', 34.269447, -118.781476, 126356, 30),
('Santa Clara, CA', 'CA', 37.354108, -121.955236, 127647, 25),
('Victorville, CA', 'CA', 34.536259, -117.291153, 134810, 40),
('Vallejo, CA', 'CA', 38.104086, -122.256637, 121253, 30),
('Berkeley, CA', 'CA', 37.871593, -122.272747, 124321, 20),
('El Monte, CA', 'CA', 34.068621, -118.027567, 113475, 20),

-- ============================================================================
-- COLORADO (12 locations)
-- ============================================================================
('Denver, CO', 'CO', 39.739236, -104.990251, 715522, 45),
('Colorado Springs, CO', 'CO', 38.833882, -104.821363, 478961, 45),
('Aurora, CO', 'CO', 39.729432, -104.831917, 386261, 35),
('Fort Collins, CO', 'CO', 40.585260, -105.084423, 169810, 40),
('Lakewood, CO', 'CO', 39.704620, -105.081324, 155984, 30),
('Thornton, CO', 'CO', 39.867979, -104.971977, 141867, 30),
('Arvada, CO', 'CO', 39.802764, -105.087485, 124402, 30),
('Westminster, CO', 'CO', 39.836653, -105.037204, 116317, 25),
('Pueblo, CO', 'CO', 38.254447, -104.609141, 111876, 40),
('Centennial, CO', 'CO', 39.579155, -104.876916, 108418, 25),
('Boulder, CO', 'CO', 40.014986, -105.270546, 108250, 30),
('Grand Junction, CO', 'CO', 39.063850, -108.550649, 65560, 40),

-- ============================================================================
-- CONNECTICUT (8 locations)
-- ============================================================================
('Bridgeport, CT', 'CT', 41.186548, -73.195176, 148654, 30),
('New Haven, CT', 'CT', 41.308274, -72.927884, 134023, 30),
('Hartford, CT', 'CT', 41.763711, -72.685093, 121054, 35),
('Stamford, CT', 'CT', 41.053429, -73.538734, 135470, 30),
('Waterbury, CT', 'CT', 41.558153, -73.051497, 114403, 30),
('Norwalk, CT', 'CT', 41.117744, -73.408156, 91184, 25),
('Danbury, CT', 'CT', 41.394817, -73.454011, 86518, 30),
('New Britain, CT', 'CT', 41.661220, -72.779549, 74135, 25),

-- ============================================================================
-- DELAWARE (4 locations)
-- ============================================================================
('Wilmington, DE', 'DE', 39.745947, -75.546589, 70898, 35),
('Dover, DE', 'DE', 39.158168, -75.524368, 39403, 35),
('Newark, DE', 'DE', 39.683723, -75.749657, 33673, 25),
('Middletown, DE', 'DE', 39.449567, -75.716377, 22350, 30),

-- ============================================================================
-- FLORIDA (30 locations)
-- ============================================================================
('Jacksonville, FL', 'FL', 30.332184, -81.655651, 949611, 50),
('Miami, FL', 'FL', 25.761680, -80.191790, 442241, 40),
('Tampa, FL', 'FL', 27.950575, -82.457178, 384959, 40),
('Orlando, FL', 'FL', 28.538336, -81.379234, 307573, 45),
('St. Petersburg, FL', 'FL', 27.773056, -82.640000, 258308, 35),
('Hialeah, FL', 'FL', 25.857597, -80.278106, 223109, 30),
('Tallahassee, FL', 'FL', 30.438256, -84.280733, 196169, 40),
('Fort Lauderdale, FL', 'FL', 26.122439, -80.143378, 182760, 35),
('Port St. Lucie, FL', 'FL', 27.273046, -80.358235, 204851, 35),
('Cape Coral, FL', 'FL', 26.562849, -81.949530, 194016, 35),
('Pembroke Pines, FL', 'FL', 26.007290, -80.296393, 171178, 30),
('Hollywood, FL', 'FL', 26.011201, -80.149490, 153627, 30),
('Miramar, FL', 'FL', 25.987320, -80.232260, 134721, 30),
('Gainesville, FL', 'FL', 29.651634, -82.324826, 141085, 40),
('Coral Springs, FL', 'FL', 26.271192, -80.270605, 134394, 30),
('Miami Gardens, FL', 'FL', 25.942080, -80.245555, 111378, 25),
('Clearwater, FL', 'FL', 27.965853, -82.800103, 117292, 30),
('Palm Bay, FL', 'FL', 28.034620, -80.588660, 119760, 35),
('Pompano Beach, FL', 'FL', 26.237860, -80.124767, 112046, 30),
('West Palm Beach, FL', 'FL', 26.715340, -80.053750, 117415, 35),
('Lakeland, FL', 'FL', 28.039465, -81.949804, 112641, 40),
('Davie, FL', 'FL', 26.076477, -80.252110, 105691, 25),
('Boca Raton, FL', 'FL', 26.358720, -80.083098, 99805, 30),
('Sunrise, FL', 'FL', 26.166860, -80.256400, 97335, 25),
('Deltona, FL', 'FL', 28.900544, -81.263675, 95027, 35),
('Plantation, FL', 'FL', 26.127368, -80.233104, 94580, 25),
('Fort Myers, FL', 'FL', 26.640628, -81.872307, 92245, 40),
('Pensacola, FL', 'FL', 30.421309, -87.216915, 52975, 40),
('Sarasota, FL', 'FL', 27.336435, -82.530653, 57738, 35),
('Ocala, FL', 'FL', 29.187199, -82.140092, 63591, 40),

-- ============================================================================
-- GEORGIA (15 locations)
-- ============================================================================
('Atlanta, GA', 'GA', 33.748995, -84.387982, 498715, 50),
('Augusta, GA', 'GA', 33.470970, -81.974851, 202081, 40),
('Columbus, GA', 'GA', 32.460976, -84.987660, 206922, 40),
('Macon, GA', 'GA', 32.840695, -83.632402, 157346, 40),
('Savannah, GA', 'GA', 32.083541, -81.099834, 147780, 40),
('Athens, GA', 'GA', 33.950794, -83.357567, 127315, 35),
('Sandy Springs, GA', 'GA', 33.924078, -84.379258, 108080, 25),
('Roswell, GA', 'GA', 34.023215, -84.361555, 92833, 30),
('Johns Creek, GA', 'GA', 34.028967, -84.198903, 84551, 25),
('Warner Robins, GA', 'GA', 32.620982, -83.599899, 80308, 35),
('Albany, GA', 'GA', 31.578507, -84.155741, 72256, 35),
('Alpharetta, GA', 'GA', 34.075376, -84.294089, 66566, 25),
('Marietta, GA', 'GA', 33.952602, -84.549927, 60867, 30),
('Valdosta, GA', 'GA', 30.832699, -83.278488, 56457, 35),
('Smyrna, GA', 'GA', 33.883690, -84.514339, 56666, 25),

-- ============================================================================
-- HAWAII (4 locations)
-- ============================================================================
('Honolulu, HI', 'HI', 21.306944, -157.858333, 350395, 30),
('Pearl City, HI', 'HI', 21.397222, -157.975000, 47698, 25),
('Hilo, HI', 'HI', 19.729722, -155.090000, 45703, 30),
('Kailua, HI', 'HI', 21.402222, -157.740556, 40514, 25),

-- ============================================================================
-- IDAHO (6 locations)
-- ============================================================================
('Boise, ID', 'ID', 43.615020, -116.202316, 235684, 45),
('Meridian, ID', 'ID', 43.612066, -116.391513, 117635, 35),
('Nampa, ID', 'ID', 43.540707, -116.563465, 100200, 35),
('Idaho Falls, ID', 'ID', 43.466575, -112.034500, 64573, 40),
('Pocatello, ID', 'ID', 42.871390, -112.443559, 56320, 40),
('Caldwell, ID', 'ID', 43.662596, -116.687717, 59773, 30),

-- ============================================================================
-- ILLINOIS (18 locations)
-- ============================================================================
('Chicago, IL', 'IL', 41.878114, -87.629798, 2746388, 50),
('Aurora, IL', 'IL', 41.760586, -88.320072, 180542, 35),
('Naperville, IL', 'IL', 41.785572, -88.147261, 149540, 30),
('Joliet, IL', 'IL', 41.525031, -88.081725, 150362, 35),
('Rockford, IL', 'IL', 42.271131, -89.094040, 148655, 40),
('Springfield, IL', 'IL', 39.781721, -89.650148, 114394, 40),
('Elgin, IL', 'IL', 42.037054, -88.281089, 114797, 30),
('Peoria, IL', 'IL', 40.693650, -89.588979, 113150, 40),
('Champaign, IL', 'IL', 40.116420, -88.243385, 88302, 35),
('Waukegan, IL', 'IL', 42.363640, -87.844788, 89321, 30),
('Cicero, IL', 'IL', 41.845608, -87.753784, 83891, 20),
('Bloomington, IL', 'IL', 40.484203, -88.993686, 78680, 35),
('Arlington Heights, IL', 'IL', 42.088100, -87.980620, 77676, 25),
('Evanston, IL', 'IL', 42.041189, -87.687531, 78110, 20),
('Decatur, IL', 'IL', 39.840390, -88.953898, 70522, 35),
('Schaumburg, IL', 'IL', 42.033360, -88.083407, 78723, 25),
('Bolingbrook, IL', 'IL', 41.698636, -88.068840, 73936, 25),
('Palatine, IL', 'IL', 42.114780, -88.034288, 69144, 25),

-- ============================================================================
-- INDIANA (12 locations)
-- ============================================================================
('Indianapolis, IN', 'IN', 39.768403, -86.158068, 887642, 50),
('Fort Wayne, IN', 'IN', 41.079273, -85.139351, 263886, 45),
('Evansville, IN', 'IN', 37.971558, -87.571090, 117429, 40),
('South Bend, IN', 'IN', 41.676355, -86.251984, 103453, 40),
('Carmel, IN', 'IN', 39.978371, -86.118045, 99757, 30),
('Bloomington, IN', 'IN', 39.165325, -86.526386, 84981, 35),
('Fishers, IN', 'IN', 39.957787, -85.968879, 98977, 30),
('Hammond, IN', 'IN', 41.583370, -87.500040, 77879, 30),
('Gary, IN', 'IN', 41.593370, -87.346427, 69093, 35),
('Lafayette, IN', 'IN', 40.416702, -86.875288, 72540, 35),
('Muncie, IN', 'IN', 40.193380, -85.386353, 67739, 35),
('Terre Haute, IN', 'IN', 39.466703, -87.413909, 58389, 35),

-- ============================================================================
-- IOWA (8 locations)
-- ============================================================================
('Des Moines, IA', 'IA', 41.586105, -93.624883, 214237, 45),
('Cedar Rapids, IA', 'IA', 41.977879, -91.665620, 137710, 40),
('Davenport, IA', 'IA', 41.523643, -90.577637, 101724, 40),
('Sioux City, IA', 'IA', 42.499994, -96.400307, 85797, 40),
('Iowa City, IA', 'IA', 41.661129, -91.530167, 74828, 35),
('Waterloo, IA', 'IA', 42.492786, -92.342578, 67314, 35),
('Ames, IA', 'IA', 42.034722, -93.619722, 66427, 35),
('Council Bluffs, IA', 'IA', 41.261944, -95.860833, 62230, 35),

-- ============================================================================
-- KANSAS (8 locations)
-- ============================================================================
('Wichita, KS', 'KS', 37.688889, -97.336111, 397532, 45),
('Overland Park, KS', 'KS', 38.982228, -94.670792, 197238, 35),
('Kansas City, KS', 'KS', 39.114053, -94.627464, 156607, 35),
('Olathe, KS', 'KS', 38.881401, -94.819054, 141290, 30),
('Topeka, KS', 'KS', 39.033437, -95.675366, 126587, 40),
('Lawrence, KS', 'KS', 38.971667, -95.235278, 94934, 35),
('Shawnee, KS', 'KS', 39.041672, -94.720238, 67311, 25),
('Manhattan, KS', 'KS', 39.183608, -96.571670, 55045, 35),

-- ============================================================================
-- KENTUCKY (8 locations)
-- ============================================================================
('Louisville, KY', 'KY', 38.252665, -85.758456, 633045, 50),
('Lexington, KY', 'KY', 38.040584, -84.503716, 322570, 45),
('Bowling Green, KY', 'KY', 36.990320, -86.443604, 74067, 40),
('Owensboro, KY', 'KY', 37.774040, -87.113282, 60183, 35),
('Covington, KY', 'KY', 39.083741, -84.508539, 42003, 30),
('Frankfort, KY', 'KY', 38.200905, -84.873284, 28602, 35),
('Richmond, KY', 'KY', 37.747871, -84.294678, 36555, 30),
('Florence, KY', 'KY', 38.998859, -84.626555, 33236, 30),

-- ============================================================================
-- LOUISIANA (10 locations)
-- ============================================================================
('New Orleans, LA', 'LA', 29.951066, -90.071532, 383997, 45),
('Baton Rouge, LA', 'LA', 30.451465, -91.154551, 227470, 45),
('Shreveport, LA', 'LA', 32.525152, -93.750179, 187593, 45),
('Lafayette, LA', 'LA', 30.224089, -92.019844, 126185, 40),
('Lake Charles, LA', 'LA', 30.213090, -93.208550, 83137, 40),
('Kenner, LA', 'LA', 29.994370, -90.241749, 66975, 25),
('Bossier City, LA', 'LA', 32.515993, -93.732101, 68094, 30),
('Monroe, LA', 'LA', 32.509309, -92.119301, 47877, 40),
('Alexandria, LA', 'LA', 31.311294, -92.445137, 47723, 40),
('Houma, LA', 'LA', 29.595779, -90.719544, 33727, 35),

-- ============================================================================
-- MAINE (4 locations)
-- ============================================================================
('Portland, ME', 'ME', 43.661471, -70.255326, 68408, 40),
('Lewiston, ME', 'ME', 44.100351, -70.214776, 37121, 35),
('Bangor, ME', 'ME', 44.801182, -68.777814, 31753, 40),
('Augusta, ME', 'ME', 44.310623, -69.779490, 18899, 35),

-- ============================================================================
-- MARYLAND (12 locations)
-- ============================================================================
('Baltimore, MD', 'MD', 39.290385, -76.612189, 585708, 45),
('Frederick, MD', 'MD', 39.414269, -77.410541, 78171, 35),
('Rockville, MD', 'MD', 39.084063, -77.152716, 68401, 25),
('Gaithersburg, MD', 'MD', 39.143480, -77.201370, 69657, 25),
('Bowie, MD', 'MD', 38.942780, -76.730531, 58662, 30),
('Hagerstown, MD', 'MD', 39.641766, -77.719997, 44371, 35),
('Annapolis, MD', 'MD', 38.978445, -76.492180, 40812, 30),
('College Park, MD', 'MD', 38.980666, -76.937500, 32303, 25),
('Salisbury, MD', 'MD', 38.360674, -75.599355, 32899, 35),
('Laurel, MD', 'MD', 39.099374, -76.848427, 26600, 25),
('Greenbelt, MD', 'MD', 38.995574, -76.881850, 24921, 25),
('Cumberland, MD', 'MD', 39.652870, -78.762514, 19972, 35),

-- ============================================================================
-- MASSACHUSETTS (15 locations)
-- ============================================================================
('Boston, MA', 'MA', 42.360083, -71.058880, 675647, 40),
('Worcester, MA', 'MA', 42.262593, -71.802293, 206518, 40),
('Springfield, MA', 'MA', 42.101483, -72.589811, 155929, 40),
('Cambridge, MA', 'MA', 42.373616, -71.109733, 118403, 20),
('Lowell, MA', 'MA', 42.633425, -71.316172, 115554, 30),
('Brockton, MA', 'MA', 42.083431, -71.018379, 105643, 30),
('New Bedford, MA', 'MA', 41.636129, -70.927491, 101079, 35),
('Quincy, MA', 'MA', 42.252875, -71.002331, 101636, 25),
('Lynn, MA', 'MA', 42.466760, -70.949494, 101253, 25),
('Fall River, MA', 'MA', 41.701764, -71.155045, 94000, 30),
('Newton, MA', 'MA', 42.337084, -71.209183, 88923, 20),
('Lawrence, MA', 'MA', 42.707070, -71.163118, 89143, 25),
('Somerville, MA', 'MA', 42.387597, -71.099497, 81045, 15),
('Framingham, MA', 'MA', 42.279286, -71.416382, 72032, 25),
('Haverhill, MA', 'MA', 42.776291, -71.077324, 67104, 30),

-- ============================================================================
-- MICHIGAN (15 locations)
-- ============================================================================
('Detroit, MI', 'MI', 42.331427, -83.045754, 639111, 45),
('Grand Rapids, MI', 'MI', 42.963360, -85.668086, 198917, 40),
('Warren, MI', 'MI', 42.514840, -83.027712, 139387, 30),
('Sterling Heights, MI', 'MI', 42.580312, -83.030203, 134346, 30),
('Ann Arbor, MI', 'MI', 42.280826, -83.743038, 123851, 35),
('Lansing, MI', 'MI', 42.732535, -84.555535, 118210, 40),
('Dearborn, MI', 'MI', 42.322259, -83.176315, 109976, 25),
('Livonia, MI', 'MI', 42.368370, -83.352661, 95535, 25),
('Troy, MI', 'MI', 42.605590, -83.149933, 87294, 25),
('Westland, MI', 'MI', 42.324206, -83.400212, 84094, 25),
('Farmington Hills, MI', 'MI', 42.499100, -83.377232, 83986, 25),
('Kalamazoo, MI', 'MI', 42.291707, -85.587229, 74262, 35),
('Wyoming, MI', 'MI', 42.913359, -85.705309, 76691, 25),
('Southfield, MI', 'MI', 42.473369, -83.221870, 75736, 25),
('Flint, MI', 'MI', 43.012527, -83.687456, 95943, 40),

-- ============================================================================
-- MINNESOTA (10 locations)
-- ============================================================================
('Minneapolis, MN', 'MN', 44.977753, -93.265011, 429954, 45),
('Saint Paul, MN', 'MN', 44.953703, -93.089958, 311527, 35),
('Rochester, MN', 'MN', 44.021580, -92.469896, 121395, 40),
('Duluth, MN', 'MN', 46.786672, -92.100485, 90880, 45),
('Bloomington, MN', 'MN', 44.840798, -93.298292, 89987, 25),
('Brooklyn Park, MN', 'MN', 45.094390, -93.356184, 86478, 25),
('Plymouth, MN', 'MN', 45.010562, -93.455710, 81026, 25),
('St. Cloud, MN', 'MN', 45.560833, -94.162222, 68881, 40),
('Woodbury, MN', 'MN', 44.923889, -92.959444, 75102, 25),
('Maple Grove, MN', 'MN', 45.072460, -93.455780, 71569, 25),

-- ============================================================================
-- MISSISSIPPI (8 locations)
-- ============================================================================
('Jackson, MS', 'MS', 32.298757, -90.184810, 153701, 45),
('Gulfport, MS', 'MS', 30.367420, -89.092816, 72926, 40),
('Southaven, MS', 'MS', 34.988889, -90.012500, 55026, 35),
('Hattiesburg, MS', 'MS', 31.327119, -89.290338, 48329, 40),
('Biloxi, MS', 'MS', 30.396032, -88.885308, 46212, 35),
('Meridian, MS', 'MS', 32.364311, -88.703656, 37252, 40),
('Tupelo, MS', 'MS', 34.257669, -88.703384, 38300, 40),
('Olive Branch, MS', 'MS', 34.961810, -89.829453, 44054, 30),

-- ============================================================================
-- MISSOURI (12 locations)
-- ============================================================================
('Kansas City, MO', 'MO', 39.099727, -94.578567, 508090, 50),
('St. Louis, MO', 'MO', 38.627003, -90.199404, 301578, 45),
('Springfield, MO', 'MO', 37.215326, -93.298409, 169176, 45),
('Columbia, MO', 'MO', 38.951706, -92.334072, 126254, 40),
('Independence, MO', 'MO', 39.091095, -94.415507, 123011, 30),
('Lee''s Summit, MO', 'MO', 38.910841, -94.382172, 101108, 30),
('O''Fallon, MO', 'MO', 38.810648, -90.699850, 91316, 30),
('St. Joseph, MO', 'MO', 39.768716, -94.846680, 72473, 40),
('St. Charles, MO', 'MO', 38.783859, -90.481227, 70650, 30),
('St. Peters, MO', 'MO', 38.800333, -90.626564, 57728, 25),
('Jefferson City, MO', 'MO', 38.576702, -92.173516, 43228, 40),
('Joplin, MO', 'MO', 37.084230, -94.513281, 51762, 40),

-- ============================================================================
-- MONTANA (5 locations)
-- ============================================================================
('Billings, MT', 'MT', 45.783287, -108.500690, 117116, 50),
('Missoula, MT', 'MT', 46.871871, -113.993271, 75516, 45),
('Great Falls, MT', 'MT', 47.506210, -111.300050, 60506, 45),
('Bozeman, MT', 'MT', 45.679553, -111.044047, 53293, 45),
('Helena, MT', 'MT', 46.588680, -112.024051, 32315, 45),

-- ============================================================================
-- NEBRASKA (6 locations)
-- ============================================================================
('Omaha, NE', 'NE', 41.252363, -95.997988, 486051, 50),
('Lincoln, NE', 'NE', 40.813616, -96.702598, 291082, 45),
('Bellevue, NE', 'NE', 41.136716, -95.890835, 64176, 30),
('Grand Island, NE', 'NE', 40.925052, -98.341980, 51390, 40),
('Kearney, NE', 'NE', 40.699509, -99.081407, 34089, 40),
('Fremont, NE', 'NE', 41.433316, -96.498062, 26397, 35),

-- ============================================================================
-- NEVADA (6 locations)
-- ============================================================================
('Las Vegas, NV', 'NV', 36.169941, -115.139830, 641903, 50),
('Henderson, NV', 'NV', 36.039525, -114.981721, 320189, 35),
('Reno, NV', 'NV', 39.529633, -119.813803, 264165, 45),
('North Las Vegas, NV', 'NV', 36.198859, -115.117502, 262527, 35),
('Sparks, NV', 'NV', 39.534870, -119.752689, 108445, 30),
('Carson City, NV', 'NV', 39.163797, -119.767430, 58639, 40),

-- ============================================================================
-- NEW HAMPSHIRE (5 locations)
-- ============================================================================
('Manchester, NH', 'NH', 42.995640, -71.454789, 115644, 40),
('Nashua, NH', 'NH', 42.765366, -71.467566, 91322, 35),
('Concord, NH', 'NH', 43.208137, -71.537570, 43976, 40),
('Derry, NH', 'NH', 42.880640, -71.327393, 33893, 30),
('Dover, NH', 'NH', 43.197592, -70.873745, 32741, 30),

-- ============================================================================
-- NEW JERSEY (15 locations)
-- ============================================================================
('Newark, NJ', 'NJ', 40.735657, -74.172367, 311549, 35),
('Jersey City, NJ', 'NJ', 40.728158, -74.077642, 292449, 25),
('Paterson, NJ', 'NJ', 40.916763, -74.171811, 159732, 25),
('Elizabeth, NJ', 'NJ', 40.663992, -74.210701, 137298, 25),
('Edison, NJ', 'NJ', 40.518715, -74.411560, 107588, 25),
('Woodbridge, NJ', 'NJ', 40.557580, -74.284744, 103019, 25),
('Lakewood, NJ', 'NJ', 40.096210, -74.217560, 135158, 30),
('Toms River, NJ', 'NJ', 39.953571, -74.197876, 97867, 35),
('Hamilton, NJ', 'NJ', 40.227036, -74.715256, 92297, 25),
('Trenton, NJ', 'NJ', 40.217053, -74.759815, 90871, 30),
('Clifton, NJ', 'NJ', 40.858244, -74.163773, 89460, 20),
('Camden, NJ', 'NJ', 39.925946, -75.119535, 73562, 30),
('Brick, NJ', 'NJ', 40.057946, -74.110290, 77649, 30),
('Cherry Hill, NJ', 'NJ', 39.934870, -74.993958, 74372, 25),
('Atlantic City, NJ', 'NJ', 39.364285, -74.422927, 38429, 35),

-- ============================================================================
-- NEW MEXICO (6 locations)
-- ============================================================================
('Albuquerque, NM', 'NM', 35.085334, -106.605553, 564559, 50),
('Las Cruces, NM', 'NM', 32.349800, -106.762104, 111385, 45),
('Rio Rancho, NM', 'NM', 35.282888, -106.688903, 104046, 35),
('Santa Fe, NM', 'NM', 35.687035, -105.937799, 87505, 40),
('Roswell, NM', 'NM', 33.394266, -104.523068, 48611, 45),
('Farmington, NM', 'NM', 36.727856, -108.218688, 44372, 45),

-- ============================================================================
-- NEW YORK (25 locations)
-- ============================================================================
('New York City, NY', 'NY', 40.712776, -74.005974, 8336817, 40),
('Buffalo, NY', 'NY', 42.886448, -78.878372, 278349, 45),
('Rochester, NY', 'NY', 43.156578, -77.608849, 211328, 45),
('Yonkers, NY', 'NY', 40.931496, -73.899155, 211569, 25),
('Syracuse, NY', 'NY', 43.048122, -76.147424, 148620, 45),
('Albany, NY', 'NY', 42.652580, -73.756233, 99224, 40),
('New Rochelle, NY', 'NY', 40.911430, -73.782467, 79726, 25),
('Mount Vernon, NY', 'NY', 40.912526, -73.836860, 76000, 20),
('Schenectady, NY', 'NY', 42.814228, -73.939574, 67875, 35),
('Utica, NY', 'NY', 43.100903, -75.232664, 65332, 40),
('White Plains, NY', 'NY', 41.033986, -73.762909, 59184, 25),
('Hempstead, NY', 'NY', 40.706056, -73.619167, 55361, 25),
('Troy, NY', 'NY', 42.728412, -73.691785, 51401, 30),
('Niagara Falls, NY', 'NY', 43.094491, -79.056641, 48671, 35),
('Binghamton, NY', 'NY', 42.098687, -75.917974, 47580, 40),
('Long Beach, NY', 'NY', 40.588261, -73.658486, 33454, 20),
('Ithaca, NY', 'NY', 42.443962, -76.501881, 32526, 35),
('Poughkeepsie, NY', 'NY', 41.700371, -73.921152, 32736, 35),
('Middletown, NY', 'NY', 41.445912, -74.422443, 28086, 30),
('Saratoga Springs, NY', 'NY', 43.082901, -73.785241, 28491, 30),
('Jamestown, NY', 'NY', 42.097002, -79.235392, 28712, 35),
('Kingston, NY', 'NY', 41.926928, -73.997222, 23887, 30),
('Elmira, NY', 'NY', 42.089776, -76.807734, 26582, 35),
('Watertown, NY', 'NY', 43.974784, -75.910759, 25210, 40),
('Plattsburgh, NY', 'NY', 44.699487, -73.452912, 19889, 40),

-- ============================================================================
-- NORTH CAROLINA (18 locations)
-- ============================================================================
('Charlotte, NC', 'NC', 35.227087, -80.843127, 874579, 50),
('Raleigh, NC', 'NC', 35.779591, -78.638179, 469298, 45),
('Greensboro, NC', 'NC', 36.072635, -79.791975, 299035, 45),
('Durham, NC', 'NC', 35.994033, -78.898619, 283506, 40),
('Winston-Salem, NC', 'NC', 36.099861, -80.244217, 249545, 40),
('Fayetteville, NC', 'NC', 35.052664, -78.878359, 208501, 45),
('Cary, NC', 'NC', 35.791540, -78.781116, 174721, 30),
('Wilmington, NC', 'NC', 34.225727, -77.944710, 115451, 40),
('High Point, NC', 'NC', 35.955691, -80.005251, 114059, 30),
('Concord, NC', 'NC', 35.408869, -80.579512, 105240, 35),
('Asheville, NC', 'NC', 35.595813, -82.551490, 94067, 40),
('Greenville, NC', 'NC', 35.612661, -77.366353, 92156, 40),
('Gastonia, NC', 'NC', 35.262081, -81.187325, 80411, 35),
('Jacksonville, NC', 'NC', 34.754050, -77.430160, 74438, 40),
('Chapel Hill, NC', 'NC', 35.913200, -79.055845, 61960, 25),
('Huntersville, NC', 'NC', 35.410699, -80.842854, 62756, 25),
('Apex, NC', 'NC', 35.732652, -78.850286, 64003, 25),
('Rocky Mount, NC', 'NC', 35.938134, -77.790464, 54220, 40),

-- ============================================================================
-- NORTH DAKOTA (4 locations)
-- ============================================================================
('Fargo, ND', 'ND', 46.877186, -96.789803, 125990, 50),
('Bismarck, ND', 'ND', 46.808327, -100.783739, 73529, 50),
('Grand Forks, ND', 'ND', 47.925259, -97.032852, 59166, 45),
('Minot, ND', 'ND', 48.232440, -101.296160, 49587, 50),

-- ============================================================================
-- OHIO (20 locations)
-- ============================================================================
('Columbus, OH', 'OH', 39.961176, -82.998794, 905748, 50),
('Cleveland, OH', 'OH', 41.499320, -81.694361, 372624, 45),
('Cincinnati, OH', 'OH', 39.103118, -84.512020, 309317, 45),
('Toledo, OH', 'OH', 41.663939, -83.555212, 270871, 45),
('Akron, OH', 'OH', 41.081445, -81.519005, 190469, 40),
('Dayton, OH', 'OH', 39.758948, -84.191607, 137644, 40),
('Parma, OH', 'OH', 41.404770, -81.722655, 81601, 25),
('Canton, OH', 'OH', 40.798698, -81.378447, 70458, 35),
('Youngstown, OH', 'OH', 41.099770, -80.649520, 60068, 40),
('Lorain, OH', 'OH', 41.452819, -82.182379, 65211, 30),
('Hamilton, OH', 'OH', 39.399401, -84.561317, 62477, 30),
('Springfield, OH', 'OH', 39.924257, -83.808823, 58662, 35),
('Kettering, OH', 'OH', 39.689501, -84.168559, 57862, 25),
('Elyria, OH', 'OH', 41.368175, -82.107649, 54533, 30),
('Lakewood, OH', 'OH', 41.481760, -81.798208, 50942, 20),
('Cuyahoga Falls, OH', 'OH', 41.133900, -81.484620, 51114, 25),
('Newark, OH', 'OH', 40.058174, -82.401231, 49423, 35),
('Dublin, OH', 'OH', 40.099249, -83.114089, 49328, 25),
('Mansfield, OH', 'OH', 40.758285, -82.515553, 47821, 40),
('Lima, OH', 'OH', 40.742551, -84.105370, 36024, 40),

-- ============================================================================
-- OKLAHOMA (8 locations)
-- ============================================================================
('Oklahoma City, OK', 'OK', 35.467560, -97.516428, 681054, 55),
('Tulsa, OK', 'OK', 36.153982, -95.992775, 413066, 50),
('Norman, OK', 'OK', 35.222569, -97.439478, 128026, 35),
('Broken Arrow, OK', 'OK', 36.060949, -95.790760, 113540, 30),
('Edmond, OK', 'OK', 35.652830, -97.477966, 94428, 30),
('Lawton, OK', 'OK', 34.608679, -98.390345, 89212, 40),
('Moore, OK', 'OK', 35.339420, -97.486610, 62793, 25),
('Midwest City, OK', 'OK', 35.449540, -97.396540, 58409, 25),

-- ============================================================================
-- OREGON (8 locations)
-- ============================================================================
('Portland, OR', 'OR', 45.515232, -122.658722, 652503, 45),
('Salem, OR', 'OR', 44.942898, -123.035096, 177723, 40),
('Eugene, OR', 'OR', 44.052069, -123.086754, 176654, 40),
('Gresham, OR', 'OR', 45.497990, -122.431035, 114247, 30),
('Hillsboro, OR', 'OR', 45.522890, -122.989570, 106894, 30),
('Beaverton, OR', 'OR', 45.486790, -122.803970, 97590, 25),
('Bend, OR', 'OR', 44.058174, -121.315308, 99178, 45),
('Medford, OR', 'OR', 42.326519, -122.875539, 85824, 40),

-- ============================================================================
-- PENNSYLVANIA (18 locations)
-- ============================================================================
('Philadelphia, PA', 'PA', 39.952584, -75.165222, 1584138, 50),
('Pittsburgh, PA', 'PA', 40.440625, -79.995886, 302971, 45),
('Allentown, PA', 'PA', 40.608429, -75.490183, 125845, 40),
('Reading, PA', 'PA', 40.335649, -75.926872, 95112, 35),
('Scranton, PA', 'PA', 41.408969, -75.662412, 76997, 40),
('Bethlehem, PA', 'PA', 40.625982, -75.370557, 75781, 30),
('Lancaster, PA', 'PA', 40.037875, -76.305514, 63410, 35),
('Harrisburg, PA', 'PA', 40.269789, -76.875613, 50099, 40),
('York, PA', 'PA', 39.962613, -76.727745, 44619, 35),
('Wilkes-Barre, PA', 'PA', 41.245709, -75.881241, 44328, 35),
('Erie, PA', 'PA', 42.129224, -80.085059, 94831, 45),
('Chester, PA', 'PA', 39.849560, -75.355782, 33972, 25),
('State College, PA', 'PA', 40.793280, -77.860012, 42034, 35),
('Easton, PA', 'PA', 40.691340, -75.220855, 28294, 25),
('Lebanon, PA', 'PA', 40.340598, -76.411413, 26007, 30),
('Hazleton, PA', 'PA', 40.958441, -75.974650, 24630, 30),
('Johnstown, PA', 'PA', 40.326693, -78.922050, 19195, 35),
('Chambersburg, PA', 'PA', 39.937574, -77.661172, 21017, 35),

-- ============================================================================
-- RHODE ISLAND (4 locations)
-- ============================================================================
('Providence, RI', 'RI', 41.824009, -71.412834, 190934, 35),
('Warwick, RI', 'RI', 41.700100, -71.416430, 82823, 25),
('Cranston, RI', 'RI', 41.779810, -71.437223, 82934, 25),
('Pawtucket, RI', 'RI', 41.878711, -71.382561, 75604, 25),

-- ============================================================================
-- SOUTH CAROLINA (10 locations)
-- ============================================================================
('Charleston, SC', 'SC', 32.776566, -79.930922, 150227, 45),
('Columbia, SC', 'SC', 34.000710, -81.034814, 131674, 45),
('North Charleston, SC', 'SC', 32.854622, -79.974940, 114852, 35),
('Mount Pleasant, SC', 'SC', 32.794091, -79.862599, 94993, 30),
('Rock Hill, SC', 'SC', 34.924870, -81.025089, 75048, 35),
('Greenville, SC', 'SC', 34.852619, -82.394012, 70635, 40),
('Summerville, SC', 'SC', 33.019350, -80.175659, 53643, 30),
('Goose Creek, SC', 'SC', 32.981070, -80.032570, 47060, 25),
('Spartanburg, SC', 'SC', 34.949570, -81.932053, 39288, 40),
('Myrtle Beach, SC', 'SC', 33.688856, -78.886696, 35682, 40),

-- ============================================================================
-- SOUTH DAKOTA (4 locations)
-- ============================================================================
('Sioux Falls, SD', 'SD', 43.544959, -96.731110, 192517, 50),
('Rapid City, SD', 'SD', 44.080543, -103.231015, 74703, 50),
('Aberdeen, SD', 'SD', 45.464698, -98.486483, 28324, 45),
('Pierre, SD', 'SD', 44.368317, -100.351014, 14091, 50),

-- ============================================================================
-- TENNESSEE (12 locations)
-- ============================================================================
('Nashville, TN', 'TN', 36.162664, -86.781602, 689447, 50),
('Memphis, TN', 'TN', 35.149534, -90.048980, 633104, 50),
('Knoxville, TN', 'TN', 35.960638, -83.920739, 190740, 45),
('Chattanooga, TN', 'TN', 35.045631, -85.309677, 181099, 45),
('Clarksville, TN', 'TN', 36.529853, -87.359388, 166722, 40),
('Murfreesboro, TN', 'TN', 35.845627, -86.390052, 152769, 35),
('Franklin, TN', 'TN', 35.925064, -86.868889, 83454, 30),
('Jackson, TN', 'TN', 35.614521, -88.813896, 68205, 40),
('Johnson City, TN', 'TN', 36.313269, -82.353534, 71046, 40),
('Hendersonville, TN', 'TN', 36.304766, -86.620014, 60432, 30),
('Kingsport, TN', 'TN', 36.548434, -82.561790, 54726, 35),
('Smyrna, TN', 'TN', 35.982898, -86.518612, 54438, 25),

-- ============================================================================
-- TEXAS (45 locations - second largest state)
-- ============================================================================
('Houston, TX', 'TX', 29.760427, -95.369803, 2304580, 55),
('San Antonio, TX', 'TX', 29.424122, -98.493628, 1547253, 55),
('Dallas, TX', 'TX', 32.776664, -96.796988, 1304379, 50),
('Austin, TX', 'TX', 30.267153, -97.743061, 978908, 50),
('Fort Worth, TX', 'TX', 32.755488, -97.330766, 918915, 50),
('El Paso, TX', 'TX', 31.761878, -106.485022, 678815, 50),
('Arlington, TX', 'TX', 32.735687, -97.108066, 394266, 40),
('Corpus Christi, TX', 'TX', 27.800583, -97.396381, 317863, 50),
('Plano, TX', 'TX', 33.019843, -96.698886, 287677, 35),
('Laredo, TX', 'TX', 27.530567, -99.480324, 260654, 50),
('Lubbock, TX', 'TX', 33.577863, -101.855166, 258862, 50),
('Garland, TX', 'TX', 32.912624, -96.638880, 246018, 30),
('Irving, TX', 'TX', 32.814017, -96.948894, 256684, 30),
('Amarillo, TX', 'TX', 35.221997, -101.831297, 200393, 50),
('Grand Prairie, TX', 'TX', 32.745964, -96.997780, 196100, 30),
('McKinney, TX', 'TX', 33.197249, -96.615277, 199177, 35),
('Frisco, TX', 'TX', 33.150673, -96.823611, 200509, 35),
('Brownsville, TX', 'TX', 25.901747, -97.497484, 186738, 45),
('Killeen, TX', 'TX', 31.117119, -97.727796, 153095, 40),
('Pasadena, TX', 'TX', 29.691063, -95.209099, 151950, 30),
('McAllen, TX', 'TX', 26.203407, -98.230012, 142210, 40),
('Mesquite, TX', 'TX', 32.766784, -96.599471, 150108, 30),
('Denton, TX', 'TX', 33.214841, -97.133068, 139869, 35),
('Midland, TX', 'TX', 31.997345, -102.077915, 146038, 50),
('Waco, TX', 'TX', 31.549333, -97.146670, 139236, 45),
('Carrollton, TX', 'TX', 32.953491, -96.890388, 133434, 25),
('Round Rock, TX', 'TX', 30.508255, -97.678896, 133372, 30),
('Pearland, TX', 'TX', 29.563567, -95.286047, 125828, 30),
('Abilene, TX', 'TX', 32.448736, -99.733144, 125182, 50),
('Richardson, TX', 'TX', 32.948334, -96.729917, 120981, 25),
('Odessa, TX', 'TX', 31.845682, -102.367643, 123334, 50),
('Sugar Land, TX', 'TX', 29.619632, -95.634903, 111026, 30),
('The Woodlands, TX', 'TX', 30.172390, -95.534260, 118000, 30),
('Beaumont, TX', 'TX', 30.085960, -94.101620, 115282, 45),
('League City, TX', 'TX', 29.507540, -95.094789, 111113, 30),
('Tyler, TX', 'TX', 32.351261, -95.301063, 107405, 45),
('College Station, TX', 'TX', 30.627977, -96.334407, 119304, 35),
('Allen, TX', 'TX', 33.103073, -96.670448, 105623, 25),
('San Angelo, TX', 'TX', 31.464105, -100.450387, 101004, 50),
('Wichita Falls, TX', 'TX', 33.913708, -98.493387, 104898, 45),
('Lewisville, TX', 'TX', 33.046234, -96.994174, 111822, 25),
('New Braunfels, TX', 'TX', 29.703040, -98.124469, 90209, 35),
('Temple, TX', 'TX', 31.098238, -97.342782, 82073, 40),
('Edinburg, TX', 'TX', 26.301735, -98.163344, 100243, 35),
('Bryan, TX', 'TX', 30.674364, -96.369962, 86276, 35),

-- ============================================================================
-- UTAH (8 locations)
-- ============================================================================
('Salt Lake City, UT', 'UT', 40.760779, -111.891047, 200567, 45),
('West Valley City, UT', 'UT', 40.691613, -112.001050, 140230, 30),
('Provo, UT', 'UT', 40.233844, -111.658534, 115264, 40),
('West Jordan, UT', 'UT', 40.609668, -111.939102, 116961, 30),
('Orem, UT', 'UT', 40.296917, -111.694732, 97499, 30),
('Sandy, UT', 'UT', 40.591121, -111.851389, 96380, 25),
('Ogden, UT', 'UT', 41.223000, -111.973830, 87773, 40),
('St. George, UT', 'UT', 37.104527, -113.583130, 95342, 45),

-- ============================================================================
-- VERMONT (3 locations)
-- ============================================================================
('Burlington, VT', 'VT', 44.476521, -73.212072, 45417, 40),
('South Burlington, VT', 'VT', 44.466991, -73.171021, 20292, 30),
('Montpelier, VT', 'VT', 44.260059, -72.575383, 8074, 40),

-- ============================================================================
-- VIRGINIA (15 locations)
-- ============================================================================
('Virginia Beach, VA', 'VA', 36.852926, -75.977985, 449974, 45),
('Norfolk, VA', 'VA', 36.850769, -76.285873, 244076, 40),
('Chesapeake, VA', 'VA', 36.768208, -76.287494, 249422, 40),
('Richmond, VA', 'VA', 37.540725, -77.436048, 226610, 45),
('Newport News, VA', 'VA', 37.087534, -76.473009, 186247, 40),
('Alexandria, VA', 'VA', 38.804836, -77.046921, 159467, 30),
('Hampton, VA', 'VA', 37.029872, -76.345245, 137148, 35),
('Roanoke, VA', 'VA', 37.270969, -79.941429, 99143, 40),
('Portsmouth, VA', 'VA', 36.835426, -76.298232, 97915, 30),
('Suffolk, VA', 'VA', 36.728520, -76.583610, 94324, 40),
('Lynchburg, VA', 'VA', 37.413755, -79.142250, 82168, 40),
('Harrisonburg, VA', 'VA', 38.449570, -78.869110, 54033, 40),
('Charlottesville, VA', 'VA', 38.029306, -78.476678, 47266, 35),
('Danville, VA', 'VA', 36.585973, -79.394875, 40044, 40),
('Fredericksburg, VA', 'VA', 38.303188, -77.460526, 29879, 35),

-- ============================================================================
-- WASHINGTON (12 locations)
-- ============================================================================
('Seattle, WA', 'WA', 47.606209, -122.332071, 737015, 45),
('Spokane, WA', 'WA', 47.658780, -117.426047, 222081, 50),
('Tacoma, WA', 'WA', 47.252877, -122.444291, 219346, 40),
('Vancouver, WA', 'WA', 45.639452, -122.661479, 190915, 35),
('Bellevue, WA', 'WA', 47.610377, -122.200680, 151854, 30),
('Kent, WA', 'WA', 47.380932, -122.234840, 136588, 30),
('Everett, WA', 'WA', 47.978985, -122.202079, 111475, 35),
('Renton, WA', 'WA', 47.482876, -122.217064, 106785, 25),
('Spokane Valley, WA', 'WA', 47.673279, -117.239481, 102976, 30),
('Federal Way, WA', 'WA', 47.323398, -122.312685, 101030, 30),
('Olympia, WA', 'WA', 47.037874, -122.900696, 55605, 40),
('Bellingham, WA', 'WA', 48.759553, -122.488225, 91482, 40),

-- ============================================================================
-- WEST VIRGINIA (5 locations)
-- ============================================================================
('Charleston, WV', 'WV', 38.349820, -81.632622, 48864, 45),
('Huntington, WV', 'WV', 38.419250, -82.445154, 46842, 45),
('Morgantown, WV', 'WV', 39.629526, -79.955897, 30955, 40),
('Parkersburg, WV', 'WV', 39.266736, -81.561514, 29675, 40),
('Wheeling, WV', 'WV', 40.063954, -80.721008, 27066, 40),

-- ============================================================================
-- WISCONSIN (12 locations)
-- ============================================================================
('Milwaukee, WI', 'WI', 43.038902, -87.906474, 577222, 45),
('Madison, WI', 'WI', 43.073052, -89.401230, 269840, 45),
('Green Bay, WI', 'WI', 44.519159, -88.019826, 107395, 40),
('Kenosha, WI', 'WI', 42.584743, -87.821185, 99889, 35),
('Racine, WI', 'WI', 42.726131, -87.782852, 77816, 30),
('Appleton, WI', 'WI', 44.261931, -88.415385, 75644, 35),
('Waukesha, WI', 'WI', 43.011679, -88.231477, 72489, 30),
('Eau Claire, WI', 'WI', 44.811349, -91.498494, 69421, 40),
('Oshkosh, WI', 'WI', 44.024706, -88.542614, 66778, 35),
('Janesville, WI', 'WI', 42.682728, -89.018722, 65615, 35),
('West Allis, WI', 'WI', 43.016681, -88.007031, 60697, 25),
('La Crosse, WI', 'WI', 43.801359, -91.239580, 52680, 40),

-- ============================================================================
-- WYOMING (4 locations)
-- ============================================================================
('Cheyenne, WY', 'WY', 41.140262, -104.820236, 65132, 50),
('Casper, WY', 'WY', 42.866632, -106.313081, 58470, 55),
('Laramie, WY', 'WY', 41.311367, -105.591101, 32711, 50),
('Gillette, WY', 'WY', 44.291069, -105.502222, 33403, 55)

ON CONFLICT (name) DO UPDATE SET
  latitude = EXCLUDED.latitude,
  longitude = EXCLUDED.longitude,
  population = EXCLUDED.population,
  radius_miles = EXCLUDED.radius_miles,
  state_code = EXCLUDED.state_code,
  updated_at = NOW();

-- ============================================================================
-- HELPER FUNCTIONS
-- ============================================================================

-- Function to get next locations to sweep (prioritized by population, oldest sweep first)
CREATE OR REPLACE FUNCTION get_next_fb_marketplace_locations(
  p_limit INTEGER DEFAULT 10,
  p_state_code TEXT DEFAULT NULL
)
RETURNS SETOF fb_marketplace_locations
LANGUAGE plpgsql
AS $$
BEGIN
  RETURN QUERY
  SELECT *
  FROM fb_marketplace_locations
  WHERE is_active = TRUE
    AND (p_state_code IS NULL OR state_code = p_state_code)
  ORDER BY
    last_sweep_at NULLS FIRST,
    population DESC NULLS LAST
  LIMIT p_limit;
END;
$$;

-- Function to update location after sweep
CREATE OR REPLACE FUNCTION update_fb_location_after_sweep(
  p_location_id UUID,
  p_listings_found INTEGER
)
RETURNS fb_marketplace_locations
LANGUAGE plpgsql
AS $$
DECLARE
  v_result fb_marketplace_locations;
BEGIN
  UPDATE fb_marketplace_locations
  SET
    last_sweep_at = NOW(),
    last_sweep_listings = p_listings_found,
    total_listings_found = total_listings_found + p_listings_found,
    updated_at = NOW()
  WHERE id = p_location_id
  RETURNING * INTO v_result;

  RETURN v_result;
END;
$$;

-- Function to get coverage stats by state
CREATE OR REPLACE FUNCTION get_fb_marketplace_coverage_stats()
RETURNS TABLE (
  state_code TEXT,
  location_count BIGINT,
  total_population BIGINT,
  active_locations BIGINT,
  locations_never_swept BIGINT,
  total_listings BIGINT
)
LANGUAGE plpgsql
AS $$
BEGIN
  RETURN QUERY
  SELECT
    l.state_code,
    COUNT(*) as location_count,
    COALESCE(SUM(l.population), 0) as total_population,
    COUNT(*) FILTER (WHERE l.is_active = TRUE) as active_locations,
    COUNT(*) FILTER (WHERE l.last_sweep_at IS NULL) as locations_never_swept,
    COALESCE(SUM(l.total_listings_found), 0) as total_listings
  FROM fb_marketplace_locations l
  GROUP BY l.state_code
  ORDER BY total_population DESC;
END;
$$;

-- Add trigger for updated_at
CREATE OR REPLACE FUNCTION update_fb_marketplace_locations_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS trigger_fb_marketplace_locations_updated_at ON fb_marketplace_locations;
CREATE TRIGGER trigger_fb_marketplace_locations_updated_at
  BEFORE UPDATE ON fb_marketplace_locations
  FOR EACH ROW
  EXECUTE FUNCTION update_fb_marketplace_locations_updated_at();

-- Grant permissions
GRANT SELECT, INSERT, UPDATE ON fb_marketplace_locations TO authenticated;
GRANT SELECT ON fb_marketplace_locations TO anon;
GRANT EXECUTE ON FUNCTION get_next_fb_marketplace_locations TO authenticated;
GRANT EXECUTE ON FUNCTION update_fb_location_after_sweep TO authenticated;
GRANT EXECUTE ON FUNCTION get_fb_marketplace_coverage_stats TO authenticated;

-- Summary comment
COMMENT ON TABLE fb_marketplace_locations IS 'Geographic coverage for Facebook Marketplace vehicle listing sweeps. Contains 500+ US metro areas with coordinates and population data for prioritized sweeping.';
